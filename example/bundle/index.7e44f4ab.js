var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},r={},n=e.parcelRequire5b70;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in r){var n=r[e];delete r[e];var a={id:e,exports:{}};return t[e]=a,n.call(a.exports,a,a.exports),a.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){r[e]=t},e.parcelRequire5b70=n);var a=n("ilwiq"),o=n("kp7Te"),i=n("891vQ"),s=n("7lx9d");a=n("ilwiq");const l=new a.Vector3,c=new a.Vector3;class d extends a.ShaderMaterial{constructor(e){super({uniforms:a.UniformsUtils.merge([a.UniformsLib.fog,{diffuse:{value:new a.Color},opacity:{value:1}}]),vertexShader:"\n\t\t\t\tattribute vec3 control0;\n\t\t\t\tattribute vec3 control1;\n\t\t\t\tattribute vec3 direction;\n\t\t\t\tvarying float discardFlag;\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <color_pars_vertex>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>\n\t\t\t\tvoid main() {\n\t\t\t\t\t#include <color_vertex>\n\n\t\t\t\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t\t\t// Transform the line segment ends and control points into camera clip space\n\t\t\t\t\tvec4 c0 = projectionMatrix * modelViewMatrix * vec4( control0, 1.0 );\n\t\t\t\t\tvec4 c1 = projectionMatrix * modelViewMatrix * vec4( control1, 1.0 );\n\t\t\t\t\tvec4 p0 = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\tvec4 p1 = projectionMatrix * modelViewMatrix * vec4( position + direction, 1.0 );\n\n\t\t\t\t\tc0.xy /= c0.w;\n\t\t\t\t\tc1.xy /= c1.w;\n\t\t\t\t\tp0.xy /= p0.w;\n\t\t\t\t\tp1.xy /= p1.w;\n\n\t\t\t\t\t// Get the direction of the segment and an orthogonal vector\n\t\t\t\t\tvec2 dir = p1.xy - p0.xy;\n\t\t\t\t\tvec2 norm = vec2( -dir.y, dir.x );\n\n\t\t\t\t\t// Get control point directions from the line\n\t\t\t\t\tvec2 c0dir = c0.xy - p1.xy;\n\t\t\t\t\tvec2 c1dir = c1.xy - p1.xy;\n\n\t\t\t\t\t// If the vectors to the controls points are pointed in different directions away\n\t\t\t\t\t// from the line segment then the line should not be drawn.\n\t\t\t\t\tfloat d0 = dot( normalize( norm ), normalize( c0dir ) );\n\t\t\t\t\tfloat d1 = dot( normalize( norm ), normalize( c1dir ) );\n\t\t\t\t\tdiscardFlag = float( sign( d0 ) != sign( d1 ) );\n\n\t\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\t\t#include <fog_vertex>\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\tuniform vec3 diffuse;\n\t\t\tuniform float opacity;\n\t\t\tvarying float discardFlag;\n\n\t\t\t#include <common>\n\t\t\t#include <color_pars_fragment>\n\t\t\t#include <fog_pars_fragment>\n\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t#include <clipping_planes_pars_fragment>\n\t\t\tvoid main() {\n\n\t\t\t\tif ( discardFlag > 0.5 ) discard;\n\n\t\t\t\t#include <clipping_planes_fragment>\n\t\t\t\tvec3 outgoingLight = vec3( 0.0 );\n\t\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t\t\t\t#include <logdepthbuf_fragment>\n\t\t\t\t#include <color_fragment>\n\t\t\t\toutgoingLight = diffuseColor.rgb; // simple shader\n\t\t\t\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t#include <encodings_fragment>\n\t\t\t\t#include <fog_fragment>\n\t\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t}\n\t\t\t"}),Object.defineProperties(this,{opacity:{get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},color:{get:function(){return this.uniforms.diffuse.value}}}),this.setValues(e),this.isLDrawConditionalLineMaterial=!0}}class u extends a.LineSegments{constructor(e,t){super(e,t),this.isConditionalLine=!0}}const h=new a.Ray;function m(e){return"Part"===e||"Unofficial_Part"===e}class p{constructor(e,t){this.line=e,this.lineLength=e.length,this.currentCharIndex=0,this.currentChar=" ",this.lineNumber=t}seekNonSpace(){for(;this.currentCharIndex<this.lineLength;){if(this.currentChar=this.line.charAt(this.currentCharIndex)," "!==this.currentChar&&"\t"!==this.currentChar)return;this.currentCharIndex++}}getToken(){const e=this.currentCharIndex++;for(;this.currentCharIndex<this.lineLength&&(this.currentChar=this.line.charAt(this.currentCharIndex)," "!==this.currentChar&&"\t"!==this.currentChar);)this.currentCharIndex++;const t=this.currentCharIndex;return this.seekNonSpace(),this.line.substring(e,t)}getVector(){return new a.Vector3(parseFloat(this.getToken()),parseFloat(this.getToken()),parseFloat(this.getToken()))}getRemainingString(){return this.line.substring(this.currentCharIndex,this.lineLength)}isAtTheEnd(){return this.currentCharIndex>=this.lineLength}setToEnd(){this.currentCharIndex=this.lineLength}getLineNumberString(){return this.lineNumber>=0?" at line "+this.lineNumber:""}}class g{constructor(e){this.loader=e,this._cache={}}cloneResult(e){const t={};return t.faces=e.faces.map((e=>({colorCode:e.colorCode,material:e.material,vertices:e.vertices.map((e=>e.clone())),normals:e.normals.map((()=>null)),faceNormal:null}))),t.conditionalSegments=e.conditionalSegments.map((e=>({colorCode:e.colorCode,material:e.material,vertices:e.vertices.map((e=>e.clone())),controlPoints:e.controlPoints.map((e=>e.clone()))}))),t.lineSegments=e.lineSegments.map((e=>({colorCode:e.colorCode,material:e.material,vertices:e.vertices.map((e=>e.clone()))}))),t.type=e.type,t.category=e.category,t.keywords=e.keywords,t.subobjects=e.subobjects,t.totalFaces=e.totalFaces,t.startingConstructionStep=e.startingConstructionStep,t.materials=e.materials,t.group=null,t}async fetchData(e){let t=!1,r=0;for(;6!==r;){let n=e;switch(r){case 0:r+=1;break;case 1:n="parts/"+n,r+=1;break;case 2:n="p/"+n,r+=1;break;case 3:n="models/"+n,r+=1;break;case 4:n=e.substring(0,e.lastIndexOf("/")+1)+n,r+=1;break;case 5:t?r=6:(n=e=e.toLowerCase(),t=!0,r=0)}const o=this.loader,i=new a.FileLoader(o.manager);i.setPath(o.partsLibraryPath),i.setRequestHeader(o.requestHeader),i.setWithCredentials(o.withCredentials);try{return await i.loadAsync(n)}catch{continue}}throw new Error('LDrawLoader: Subobject "'+e+'" could not be loaded.')}parse(e,t=null){const r=this.loader,n=[],o=[],i=[],s=[],l={},c=e=>l[e]||null;let d="Model",u=null,h=null,m=0;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n"));const g=e.split("\n"),f=g.length;let b=!1,w=null,y=null,M=!1,v=!0,C=!1,x=!0,S=!1;for(let e=0;e<f;e++){const t=g[e];if(0===t.length)continue;if(b){t.startsWith("0 FILE ")?(this.setData(w,y),w=t.substring(7),y=""):y+=t+"\n";continue}const f=new p(t,e+1);if(f.seekNonSpace(),f.isAtTheEnd())continue;const T=f.getToken();let L,E,k,R,_,A,F,D,P,I,N;switch(T){case"0":const t=f.getToken();if(t)switch(t){case"!LDRAW_ORG":d=f.getToken();break;case"!COLOUR":L=r.parseColorMetaDirective(f),L?l[L.userData.code]=L:console.warn("LDrawLoader: Error parsing material"+f.getLineNumberString());break;case"!CATEGORY":u=f.getToken();break;case"!KEYWORDS":const t=f.getRemainingString().split(",");t.length>0&&(h||(h=[]),t.forEach((function(e){h.push(e.trim())})));break;case"FILE":e>0&&(b=!0,w=f.getRemainingString(),y="",M=!1,v=!0);break;case"BFC":for(;!f.isAtTheEnd();){const e=f.getToken();switch(e){case"CERTIFY":case"NOCERTIFY":M="CERTIFY"===e,v=!0;break;case"CW":case"CCW":v="CCW"===e;break;case"INVERTNEXT":C=!0;break;case"CLIP":case"NOCLIP":x="CLIP"===e;break;default:console.warn('THREE.LDrawLoader: BFC directive "'+e+'" is unknown.')}}break;case"STEP":S=!0}break;case"1":E=f.getToken(),L=c(E);const p=parseFloat(f.getToken()),g=parseFloat(f.getToken()),V=parseFloat(f.getToken()),G=parseFloat(f.getToken()),B=parseFloat(f.getToken()),O=parseFloat(f.getToken()),j=parseFloat(f.getToken()),z=parseFloat(f.getToken()),W=parseFloat(f.getToken()),U=parseFloat(f.getToken()),H=parseFloat(f.getToken()),q=parseFloat(f.getToken()),$=(new a.Matrix4).set(G,B,O,p,j,z,W,g,U,H,q,V,0,0,0,1);let Y=f.getRemainingString().trim().replace(/\\/g,"/");r.fileMap[Y]?Y=r.fileMap[Y]:Y.startsWith("s/")?Y="parts/"+Y:Y.startsWith("48/")&&(Y="p/"+Y),s.push({material:L,colorCode:E,matrix:$,fileName:Y,inverted:C,startingConstructionStep:S}),C=!1;break;case"2":E=f.getToken(),L=c(E),A=f.getVector(),F=f.getVector(),k={material:L,colorCode:E,vertices:[A,F]},o.push(k);break;case"5":E=f.getToken(),L=c(E),A=f.getVector(),F=f.getVector(),I=f.getVector(),N=f.getVector(),k={material:L,colorCode:E,vertices:[A,F],controlPoints:[I,N]},i.push(k);break;case"3":E=f.getToken(),L=c(E),R=v,_=!M||!x,!0===R?(A=f.getVector(),F=f.getVector(),D=f.getVector()):(D=f.getVector(),F=f.getVector(),A=f.getVector()),n.push({material:L,colorCode:E,faceNormal:null,vertices:[A,F,D],normals:[null,null,null]}),m++,!0===_&&(n.push({material:L,colorCode:E,faceNormal:null,vertices:[D,F,A],normals:[null,null,null]}),m++);break;case"4":E=f.getToken(),L=c(E),R=v,_=!M||!x,!0===R?(A=f.getVector(),F=f.getVector(),D=f.getVector(),P=f.getVector()):(P=f.getVector(),D=f.getVector(),F=f.getVector(),A=f.getVector()),n.push({material:L,colorCode:E,faceNormal:null,vertices:[A,F,D,P],normals:[null,null,null,null]}),m+=2,!0===_&&(n.push({material:L,colorCode:E,faceNormal:null,vertices:[P,D,F,A],normals:[null,null,null,null]}),m+=2);break;default:throw new Error('LDrawLoader: Unknown line type "'+T+'"'+f.getLineNumberString()+".")}}return b&&this.setData(w,y),{faces:n,conditionalSegments:i,lineSegments:o,type:d,category:u,keywords:h,subobjects:s,totalFaces:m,startingConstructionStep:S,materials:l,fileName:t,group:null}}getData(e,t=!0){const r=e.toLowerCase(),n=this._cache[r];return null===n||n instanceof Promise?null:t?this.cloneResult(n):n}async ensureDataLoaded(e){const t=e.toLowerCase();t in this._cache||(this._cache[t]=this.fetchData(e).then((r=>{const n=this.parse(r,e);return this._cache[t]=n,n}))),await this._cache[t]}setData(e,t){const r=e.toLowerCase();this._cache[r]=this.parse(t,e)}}function f(e,t,r,n){return(!n&&"16"===e||n&&"24"===e)&&(e=t),r[e]||null}class b{constructor(e){this.loader=e,this.parseCache=new g(e),this._cache={}}async processIntoMesh(e){const t=this.loader,r=this.parseCache,n=new Set,o=async(e,i=null)=>{const s=e.subobjects,l=[];for(let e=0,t=s.length;e<t;e++){const t=s[e],n=r.ensureDataLoaded(t.fileName).then((()=>{const e=r.getData(t.fileName,!1);return n=e.type,/primitive/i.test(n)||"Subpart"===n?o(r.getData(t.fileName),t):this.loadModel(t.fileName).catch((e=>(console.warn(e),null)));var n}));l.push(n)}const c=new a.Group;c.userData.category=e.category,c.userData.keywords=e.keywords,e.group=c;const d=await Promise.all(l);for(let r=0,a=d.length;r<a;r++){const a=e.subobjects[r],o=d[r];if(null===o)continue;if(o.isGroup){const r=o;a.matrix.decompose(r.position,r.quaternion,r.scale),r.userData.startingConstructionStep=a.startingConstructionStep,r.name=a.fileName,t.applyMaterialsToMesh(r,a.colorCode,e.materials),c.add(r);continue}o.group.children.length&&c.add(o.group);const i=e.lineSegments,s=e.conditionalSegments,l=e.faces,u=o.lineSegments,h=o.conditionalSegments,m=o.faces,p=a.matrix,g=a.inverted,b=p.determinant()<0,w=a.colorCode,y="16"===w?"24":w;for(let t=0,r=u.length;t<r;t++){const r=u[t],n=r.vertices;n[0].applyMatrix4(p),n[1].applyMatrix4(p),r.colorCode="24"===r.colorCode?y:r.colorCode,r.material=r.material||f(r.colorCode,r.colorCode,e.materials,!0),i.push(r)}for(let t=0,r=h.length;t<r;t++){const r=h[t],n=r.vertices,a=r.controlPoints;n[0].applyMatrix4(p),n[1].applyMatrix4(p),a[0].applyMatrix4(p),a[1].applyMatrix4(p),r.colorCode="24"===r.colorCode?y:r.colorCode,r.material=r.material||f(r.colorCode,r.colorCode,e.materials,!0),s.push(r)}for(let t=0,r=m.length;t<r;t++){const r=m[t],a=r.vertices;for(let e=0,t=a.length;e<t;e++)a[e].applyMatrix4(p);r.colorCode="16"===r.colorCode?w:r.colorCode,r.material=r.material||f(r.colorCode,w,e.materials,!1),n.add(r.colorCode),b!==g&&a.reverse(),l.push(r)}e.totalFaces+=o.totalFaces}return i&&t.applyMaterialsToMesh(c,i.colorCode,e.materials),e};for(let t=0,r=e.faces;t<r;t++)n.add(e.faces[t].colorCode);if(await o(e),t.smoothNormals){const t=n.size>1;!function(e){for(let t=0,r=e.length;t<r;t++){const r=e[t],n=r.vertices,o=n[0],i=n[1],s=n[2];l.subVectors(i,o),c.subVectors(s,i),r.faceNormal=(new a.Vector3).crossVectors(l,c).normalize()}}(e.faces),function(e,t,r=!1){const n=100*(1+1e-10);function o(e){return`${~~(e.x*n)},${~~(e.y*n)},${~~(e.z*n)}`}function i(e,t){return`${o(e)}_${o(t)}`}function s(e,t,r){r.direction.subVectors(t,e).normalize();const n=e.dot(r.direction);return r.origin.copy(e).addScaledVector(r.direction,-n),r}function l(e){return i(e.origin,e.direction)}const c=new Set,d=new Map,u={},m=[];for(let e=0,n=t.length;e<n;e++){const n=t[e].vertices,o=n[0],u=n[1];if(c.add(i(o,u)),c.add(i(u,o)),r){const e=s(o,u,new a.Ray),t=l(e);if(!d.has(t)){s(u,o,e);const r=l(e),n={ray:e,distances:[]};d.set(t,n),d.set(r,n)}const r=d.get(t);let n=r.ray.direction.dot(o),i=r.ray.direction.dot(u);n>i&&([n,i]=[i,n]),r.distances.push(n,i)}}for(let t=0,n=e.length;t<n;t++){const n=e[t],a=n.vertices,o=a.length;for(let e=0;e<o;e++){const t=e,m=(e+1)%o,p=a[t],g=a[m],f=i(p,g);if(c.has(f))continue;if(r){s(p,g,h);const e=l(h);if(d.has(e)){const t=d.get(e),{ray:r,distances:n}=t;let a=r.direction.dot(p),o=r.direction.dot(g);a>o&&([a,o]=[o,a]);let i=!1;for(let e=0,t=n.length;e<t;e+=2)if(a>=n[e]&&o<=n[e+1]){i=!0;break}if(i)continue}}const b={index:t,tri:n};u[f]=b}}for(;;){let e=null;for(const t in u){e=u[t];break}if(null===e)break;const t=[e];for(;t.length>0;){const e=t.pop().tri,r=e.vertices,n=e.normals,o=e.faceNormal,s=r.length;for(let l=0;l<s;l++){const c=l,d=(l+1)%s,h=r[c],p=r[d];delete u[i(h,p)];const g=i(p,h),f=u[g];if(f){const r=f.tri,i=f.index,s=r.normals,l=s.length,h=r.faceNormal;if(Math.abs(r.faceNormal.dot(e.faceNormal))<.25)continue;g in u&&(t.push(f),delete u[g]);const p=(i+1)%l;n[c]&&s[p]&&n[c]!==s[p]&&(s[p].norm.add(n[c].norm),n[c].norm=s[p].norm);let b=n[c]||s[p];null===b&&(b={norm:new a.Vector3},m.push(b.norm)),null===n[c]&&(n[c]=b,b.norm.add(o)),null===s[p]&&(s[p]=b,b.norm.add(h)),n[d]&&s[i]&&n[d]!==s[i]&&(s[i].norm.add(n[d].norm),n[d].norm=s[i].norm);let w=n[d]||s[i];null===w&&(w={norm:new a.Vector3},m.push(w.norm)),null===n[d]&&(n[d]=w,w.norm.add(o)),null===s[i]&&(s[i]=w,w.norm.add(h))}}}}for(let e=0,t=m.length;e<t;e++)m[e].normalize()}(e.faces,e.lineSegments,t)}const i=e.group;return e.faces.length>0&&i.add(y(e.faces,3,!1,e.totalFaces)),e.lineSegments.length>0&&i.add(y(e.lineSegments,2)),e.conditionalSegments.length>0&&i.add(y(e.conditionalSegments,2,!0)),i}hasCachedModel(e){return null!==e&&e.toLowerCase()in this._cache}async getCachedModel(e){if(null!==e&&this.hasCachedModel(e)){const t=e.toLowerCase();return(await this._cache[t]).clone()}return null}async loadModel(e){const t=this.parseCache,r=e.toLowerCase();if(this.hasCachedModel(e))return this.getCachedModel(e);{await t.ensureDataLoaded(e);const n=t.getData(e),a=this.processIntoMesh(n);if(this.hasCachedModel(e))return this.getCachedModel(e);m(n.type)&&(this._cache[r]=a);return(await a).clone()}}async parseModel(e){const t=this.parseCache.parse(e);return m(t.type)&&this.hasCachedModel(t.fileName)?this.getCachedModel(t.fileName):this.processIntoMesh(t)}}function w(e,t){return e.colorCode===t.colorCode?0:e.colorCode<t.colorCode?-1:1}function y(e,t,r=!1,n=null){e.sort(w),null===n&&(n=e.length);const o=new Float32Array(t*n*3),i=3===t?new Float32Array(t*n*3):null,s=[],d=new Array(6),h=new a.BufferGeometry;let m=null,p=0,g=0,f=0;for(let n=0,u=e.length;n<u;n++){const u=e[n];let b=u.vertices;4===b.length&&(d[0]=b[0],d[1]=b[1],d[2]=b[2],d[3]=b[0],d[4]=b[2],d[5]=b[3],b=d);for(let e=0,t=b.length;e<t;e++){const t=b[e],r=f+3*e;o[r+0]=t.x,o[r+1]=t.y,o[r+2]=t.z}if(3===t){if(!u.faceNormal){const e=b[0],t=b[1],r=b[2];l.subVectors(t,e),c.subVectors(r,t),u.faceNormal=(new a.Vector3).crossVectors(l,c).normalize()}let e=u.normals;4===e.length&&(d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[0],d[4]=e[2],d[5]=e[3],e=d);for(let t=0,r=e.length;t<r;t++){let r=u.faceNormal;e[t]&&(r=e[t].norm);const n=f+3*t;i[n+0]=r.x,i[n+1]=r.y,i[n+2]=r.z}}if(m!==u.colorCode){null!==m&&h.addGroup(p,g,s.length-1);const e=u.material;null!==e?3===t?s.push(e):2===t&&(r?s.push(e.userData.edgeMaterial.userData.conditionalEdgeMaterial):s.push(e.userData.edgeMaterial)):s.push(u.colorCode),m=u.colorCode,p=f/3,g=b.length}else g+=b.length;f+=3*b.length}g>0&&h.addGroup(p,1/0,s.length-1),h.setAttribute("position",new a.BufferAttribute(o,3)),null!==i&&h.setAttribute("normal",new a.BufferAttribute(i,3));let b=null;if(2===t?b=r?new u(h,1===s.length?s[0]:s):new a.LineSegments(h,1===s.length?s[0]:s):3===t&&(b=new a.Mesh(h,1===s.length?s[0]:s)),r){b.isConditionalLine=!0;const t=new Float32Array(6*e.length),r=new Float32Array(6*e.length),n=new Float32Array(6*e.length);for(let a=0,o=e.length;a<o;a++){const o=e[a],i=o.vertices,s=o.controlPoints,l=s[0],c=s[1],d=i[0],u=i[1],h=6*a;t[h+0]=l.x,t[h+1]=l.y,t[h+2]=l.z,t[h+3]=l.x,t[h+4]=l.y,t[h+5]=l.z,r[h+0]=c.x,r[h+1]=c.y,r[h+2]=c.z,r[h+3]=c.x,r[h+4]=c.y,r[h+5]=c.z,n[h+0]=u.x-d.x,n[h+1]=u.y-d.y,n[h+2]=u.z-d.z,n[h+3]=u.x-d.x,n[h+4]=u.y-d.y,n[h+5]=u.z-d.z}h.setAttribute("control0",new a.BufferAttribute(t,3,!1)),h.setAttribute("control1",new a.BufferAttribute(r,3,!1)),h.setAttribute("direction",new a.BufferAttribute(n,3,!1))}return b}class M extends a.Loader{constructor(e){super(e),this.materials=[],this.materialLibrary={},this.partsCache=new b(this),this.fileMap={},this.setMaterials([]),this.smoothNormals=!0,this.partsLibraryPath=""}setPartsLibraryPath(e){return this.partsLibraryPath=e,this}async preloadMaterials(e){const t=new a.FileLoader(this.manager);t.setPath(this.path),t.setRequestHeader(this.requestHeader),t.setWithCredentials(this.withCredentials);const r=/^0 !COLOUR/,n=(await t.loadAsync(e)).split(/[\n\r]/g),o=[];for(let e=0,t=n.length;e<t;e++){const t=n[e];if(r.test(t)){const e=t.replace(r,""),n=this.parseColorMetaDirective(new p(e));o.push(n)}}this.setMaterials(o)}load(e,t,r,n){const o=new a.FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(e=>{this.partsCache.parseModel(e,this.materialLibrary).then((e=>{this.applyMaterialsToMesh(e,"16",this.materialLibrary,!0),this.computeConstructionSteps(e),t(e)})).catch(n)}),r,n)}parse(e,t){this.partsCache.parseModel(e,this.materialLibrary).then((e=>{this.computeConstructionSteps(e),t(e)}))}setMaterials(e){this.materialLibrary={},this.materials=[];for(let t=0,r=e.length;t<r;t++)this.addMaterial(e[t]);return this.addMaterial(this.parseColorMetaDirective(new p("Main_Colour CODE 16 VALUE #FF8080 EDGE #333333"))),this.addMaterial(this.parseColorMetaDirective(new p("Edge_Colour CODE 24 VALUE #A0A0A0 EDGE #333333"))),this}setFileMap(e){return this.fileMap=e,this}addMaterial(e){const t=this.materialLibrary;return t[e.userData.code]||(this.materials.push(e),t[e.userData.code]=e),this}getMaterial(e){if(e.startsWith("0x2")){const t=e.substring(3);return this.parseColorMetaDirective(new p("Direct_Color_"+t+" CODE -1 VALUE #"+t+" EDGE #"+t))}return this.materialLibrary[e]||null}applyMaterialsToMesh(e,t,r,n=!1){const a=this,o="16"===t;function i(e,i){if(o&&!(i in r)&&!n)return i;const s=e.isLineSegments||e.isConditionalLine;(!s&&"16"===i||s&&"24"===i)&&(i=t);let l=null;if(i in r)l=r[i];else{if(!n)return i;if(l=a.getMaterial(i),null===l)throw new Error(`LDrawLoader: Material properties for code ${i} not available.`)}return e.isLineSegments&&(l=l.userData.edgeMaterial,e.isConditionalLine&&(l=l.userData.conditionalEdgeMaterial)),l}e.traverse((e=>{if(e.isMesh||e.isLineSegments)if(Array.isArray(e.material))for(let t=0,r=e.material.length;t<r;t++)e.material[t].isMaterial||(e.material[t]=i(e,e.material[t]));else e.material.isMaterial||(e.material=i(e,e.material))}))}getMainMaterial(){return this.getMaterial("16")}getMainEdgeMaterial(){const e=this.getMainMaterial();return e&&e.userData?e.userData.edgeMaterial:null}parseColorMetaDirective(e){let t=null,r=16711935,n=16711935,o=1,i=!1,s=0,l=0,c=null;const u=e.getToken();if(!u)throw new Error('LDrawLoader: Material name was expected after "!COLOUR tag'+e.getLineNumberString()+".");let h=null;for(;h=e.getToken(),h;)switch(h.toUpperCase()){case"CODE":t=e.getToken();break;case"VALUE":if(r=e.getToken(),r.startsWith("0x"))r="#"+r.substring(2);else if(!r.startsWith("#"))throw new Error("LDrawLoader: Invalid color while parsing material"+e.getLineNumberString()+".");break;case"EDGE":if(n=e.getToken(),n.startsWith("0x"))n="#"+n.substring(2);else if(!n.startsWith("#")){if(c=this.getMaterial(n),!c)throw new Error("LDrawLoader: Invalid edge color while parsing material"+e.getLineNumberString()+".");c=c.userData.edgeMaterial}break;case"ALPHA":if(o=parseInt(e.getToken()),isNaN(o))throw new Error("LDrawLoader: Invalid alpha value in material definition"+e.getLineNumberString()+".");o=Math.max(0,Math.min(1,o/255)),o<1&&(i=!0);break;case"LUMINANCE":if(s=parseInt(e.getToken()),isNaN(s))throw new Error("LDrawLoader: Invalid luminance value in material definition"+p.getLineNumberString()+".");s=Math.max(0,Math.min(1,s/255));break;case"CHROME":l=1;break;case"PEARLESCENT":l=2;break;case"RUBBER":l=3;break;case"MATTE_METALLIC":l=4;break;case"METAL":l=5;break;case"MATERIAL":e.setToEnd();break;default:throw new Error('LDrawLoader: Unknown token "'+h+'" while parsing material'+e.getLineNumberString()+".")}let m=null;switch(l){case 0:m=new a.MeshStandardMaterial({color:r,roughness:.3,metalness:0});break;case 2:m=new a.MeshStandardMaterial({color:r,roughness:.3,metalness:.25});break;case 1:m=new a.MeshStandardMaterial({color:r,roughness:0,metalness:1});break;case 3:m=new a.MeshStandardMaterial({color:r,roughness:.9,metalness:0});break;case 4:m=new a.MeshStandardMaterial({color:r,roughness:.8,metalness:.4});break;case 5:m=new a.MeshStandardMaterial({color:r,roughness:.2,metalness:.85})}return m.transparent=i,m.premultipliedAlpha=!0,m.opacity=o,m.depthWrite=!i,m.color.convertSRGBToLinear(),m.polygonOffset=!0,m.polygonOffsetFactor=1,0!==s&&m.emissive.set(m.color).multiplyScalar(s),c||(c=new a.LineBasicMaterial({color:n,transparent:i,opacity:o,depthWrite:!i}),c.userData.code=t,c.name=u+" - Edge",c.color.convertSRGBToLinear(),c.userData.conditionalEdgeMaterial=new d({fog:!0,transparent:i,depthWrite:!i,color:n,opacity:o}),c.userData.conditionalEdgeMaterial.color.convertSRGBToLinear()),m.userData.code=t,m.name=u,m.userData.edgeMaterial=c,this.addMaterial(m),m}computeConstructionSteps(e){let t=0;e.traverse((e=>{e.isGroup&&(e.userData.startingConstructionStep&&t++,e.userData.constructionStep=t)})),e.userData.numConstructionSteps=t+1}}a=n("ilwiq");var v=n("7ePFa");var C=n("jiuw3"),x=(a=n("ilwiq"),n("5Rd1x")),S=n("RPVlj"),T=n("8Zfx2"),L=n("a8VBx"),E=n("hWds8"),k=n("jM3IF"),R=n("9dwDm");function _(e){return e.buffer instanceof ArrayBuffer&&"BYTES_PER_ELEMENT"in e}class A{constructor(){const e=new Set;e.add("uuid"),this.ignoreKeys=e,this.shareTextures=!0,this.textures=[],this.materials=[]}areEqual(e,t){const r=new Set,n=new Set,a=this.ignoreKeys,o=(e,t)=>{if(e===t)return!0;if(e&&t&&e instanceof Object&&t instanceof Object){if(n.has(e)||n.has(t))throw new Error("MaterialReducer: Material is recursive.");const i=e instanceof Element,s=t instanceof Element;if(i||s)return i===s&&e instanceof Image&&t instanceof Image&&e.src===t.src;const l=e instanceof ImageBitmap,c=t instanceof ImageBitmap;if(l||c)return!1;if(e.equals)return e.equals(t);const d=_(e),u=_(t);if(d||u){if(d!==u||e.constructor!==t.constructor||e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}n.add(e),n.add(t),r.clear();for(const t in e)!e.hasOwnProperty(t)||e[t]instanceof Function||a.has(t)||r.add(t);for(const e in t)!t.hasOwnProperty(e)||t[e]instanceof Function||a.has(e)||r.add(e);const h=Array.from(r.values());let m=!0;for(const r in h){const n=h[r];if(!a.has(n)&&(m=o(e[n],t[n]),!m))break}return n.delete(e),n.delete(t),m}return!1};return o(e,t)}process(e){const{textures:t,materials:r}=this;let n=0;const a=e=>{let a=null;for(const t in r){const n=r[t];this.areEqual(e,n)&&(a=n)}if(a)return n++,a;if(r.push(e),this.shareTextures)for(const r in e){if(!e.hasOwnProperty(r))continue;const n=e[r];if(n&&n.isTexture&&n.image instanceof Image){let a=null;for(const e in t){const r=t[e];if(this.areEqual(r,n)){a=r;break}}a?e[r]=a:t.push(n)}}return e};return e.traverse((e=>{if(e.isMesh&&e.material){const t=e.material;if(Array.isArray(t))for(let e=0;e<t.length;e++)t[e]=a(t[e]);else e.material=a(t)}})),{replaced:n,retained:r.length}}}var F=function(){var e=0,t=document.createElement("div");function r(e){return t.appendChild(e.dom),e}function n(r){for(var n=0;n<t.children.length;n++)t.children[n].style.display=n===r?"block":"none";e=r}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(r){r.preventDefault(),n(++e%t.children.length)}),!1);var a=(performance||Date).now(),o=a,i=0,s=r(new F.Panel("FPS","#0ff","#002")),l=r(new F.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=r(new F.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:t,addPanel:r,showPanel:n,begin:function(){a=(performance||Date).now()},end:function(){i++;var e=(performance||Date).now();if(l.update(e-a,200),e>=o+1e3&&(s.update(1e3*i/(e-o),100),o=e,i=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:t,setMode:n}};F.Panel=function(e,t,r){var n=1/0,a=0,o=Math.round,i=o(window.devicePixelRatio||1),s=80*i,l=48*i,c=3*i,d=2*i,u=3*i,h=15*i,m=74*i,p=30*i,g=document.createElement("canvas");g.width=s,g.height=l,g.style.cssText="width:80px;height:48px";var f=g.getContext("2d");return f.font="bold "+9*i+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=r,f.fillRect(0,0,s,l),f.fillStyle=t,f.fillText(e,c,d),f.fillRect(u,h,m,p),f.fillStyle=r,f.globalAlpha=.9,f.fillRect(u,h,m,p),{dom:g,update:function(l,b){n=Math.min(n,l),a=Math.max(a,l),f.fillStyle=r,f.globalAlpha=1,f.fillRect(0,0,s,h),f.fillStyle=t,f.fillText(o(l)+" "+e+" ("+o(n)+"-"+o(a)+")",c,d),f.drawImage(g,u+i,h,m-i,p,u,h,m-i,p),f.fillRect(u+m-i,h,i,p),f.fillStyle=r,f.globalAlpha=.9,f.fillRect(u+m-i,h,i,o((1-l/b)*p))}}};var D=F;const P=document.getElementById("credits"),I=document.getElementById("loading"),N=document.getElementById("samples"),V=new class{get domElement(){return this._container}constructor(){this.scene=new a.Scene,this.camera=new a.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.025,500),this.camera.position.set(-1,.25,1),this.renderer=new a.WebGLRenderer({antialias:!0}),this.fsQuad=new S.FullScreenQuad(new a.MeshBasicMaterial({transparent:!0})),this.ptRenderer=new E.PathTracingRenderer(this.renderer),this.ptModel=null,this.ptMaterials=null,this.ptTextures=null,this.model=null,this.bvhGenerator=new L.GenerateMeshBVHWorker,this.onRender=null,this.enablePathTracing=!0,this.pausePathTracing=!1,this.samplesPerFrame=1,this._scale=1,this._nextObject=null,this._needsSizeUpdate=!1,this._newSize=new a.Vector2,this._resizeObserver=new ResizeObserver((e=>{const{contentRect:t}=e[0];this._newSize.set(t.width,t.height),this._needsSizeUpdate=!0}));const e=document.createElement("div");e.style.overflow="hidden",e.appendChild(this.renderer.domElement),this._container=e,this.ptRenderer.camera=this.camera,this.ptRenderer.material=new R.PhysicalPathTracingMaterial,this.renderer.outputEncoding=a.sRGBEncoding,this._resizeObserver.observe(e)}_updateSize(){const e=window.devicePixelRatio,t=this._scale,r=this._newSize;this.renderer.setPixelRatio(e),this.renderer.domElement.style.aspectRatio=`${r.width} / ${r.height}`,this.renderer.domElement.style.width="100%",this.renderer.setSize(t*r.width,t*r.height,!1),this.ptRenderer.target.setSize(r.width*t*e,r.height*t*e),this.camera.aspect=r.width/r.height,this.camera.updateProjectionMatrix(),this._needsSizeUpdate=!1}setScale(e){this._scale=e,this._needsSizeUpdate=!0}setModel(e,t={}){if(this.bvhGenerator.running)return void(this._nextObject=e);e.updateMatrixWorld(!0);(new A).process(e);const r=[];e.traverse((e=>{e.isMesh&&r.push(e)}));const{geometry:n,materials:o,textures:i}=k.mergeMeshes(r,{attributes:["position","normal","tangent","uv"]});return this.bvhGenerator.generate(n,{strategy:T.SAH,maxLeafTris:1,...t}).then((t=>{if(this._nextObject)return this.setModel(this._nextObject),void(this._nextObject=null);this.model&&(this.scene.remove(this.model),this.ptTextures.forEach((e=>e.dispose())),this.ptMaterials.forEach((e=>e.dispose())));const r=new a.Mesh(n);this.scene.add(e),this.ptModel=r,this.ptMaterials=o,this.ptTextures=i,this.model=e;const{ptRenderer:s}=this,{material:l}=s;l.bvh.dispose(),l.normalAttribute.dispose(),l.tangentAttribute.dispose(),l.uvAttribute.dispose(),l.materialIndexAttribute.dispose(),l.textures.dispose(),l.bvh.updateFrom(t),l.normalAttribute.updateFrom(n.attributes.normal),l.tangentAttribute.updateFrom(n.attributes.tangent),l.uvAttribute.updateFrom(n.attributes.uv),l.materialIndexAttribute.updateFrom(n.attributes.materialIndex),l.textures.setTextures(this.renderer,2048,2048,i),l.materials.updateFrom(o,i),l.setDefine("MATERIAL_LENGTH",o.length),l.filterGlossyFactor=.25,s.reset()}))}setEnvironment(e){this.scene.environment=e}init(){const{ptRenderer:e,renderer:t,fsQuad:r,camera:n}=this,a=new x.OrbitControls(n,t.domElement);let o=0;a.addEventListener("change",(()=>{const t=this.ptRenderer.tiles;t.x*t.y!=1&&(o=1),e.reset()})),t.setAnimationLoop((()=>{if(!this.pausePathTracing){if(this._needsSizeUpdate&&(this._updateSize(),this.ptRenderer.reset()),this.model){const{ptRenderer:e,ptMaterials:a,ptTextures:i}=this;if(e.material.materials.updateFrom(a,i),this.enablePathTracing&&0===o){n.updateMatrixWorld();for(let t=0,r=this.samplesPerFrame;t<r;t++)e.update();e.samples<1&&t.render(this.scene,this.camera),t.autoClear=!1,r.material.map=e.target.texture,r.render(t),t.autoClear=!0}else o>0&&o--,t.render(this.scene,this.camera)}else t.clear();this.onRender&&this.onRender()}}))}};V.init(),V.domElement.style.width="100%",V.domElement.style.height="100%",document.body.appendChild(V.domElement);const G={"Royal Esplanade":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr","Moonless Golf":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/moonless_golf_1k.hdr",Overpass:"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/pedestrian_overpass_1k.hdr","Venice Sunset":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/venice_sunset_1k.hdr"},B=window.MODEL_LIST||{"M2020 Rover":{url:"https://raw.githubusercontent.com/gkjohnson/gltf-demo-models/main/nasa-m2020/Perseverance.glb",credit:"Model credit NASA / JPL-Caltech"},"M2020 Helicopter":{url:"https://raw.githubusercontent.com/gkjohnson/gltf-demo-models/main/nasa-m2020/Ingenuity.glb",credit:"Model credit NASA / JPL-Caltech"},"Gelatinous Cube":{url:"https://raw.githubusercontent.com/gkjohnson/gltf-demo-models/main/gelatinous-cube/scene.gltf",credit:'Model by "glenatron" on Sketchfab.',rotation:[0,-Math.PI/8,0],opacityToTransmission:!0,bounces:8,postProcess(e){const t=[];e.traverse((e=>{if(e.material)if(e.material instanceof a.MeshPhysicalMaterial){const t=e.material;t.roughness*=.1,t.metalness=0,t.ior=1.2,t.map=null,e.geometry.computeVertexNormals()}else e.material.opacity<1&&t.push(e)})),t.forEach((e=>{e.parent.remove(e)}))}},"Octopus Tea":{url:"https://raw.githubusercontent.com/gkjohnson/gltf-demo-models/main/octopus-tea/scene.gltf",credit:'Model by "AzTiZ" on Sketchfab.',opacityToTransmission:!0,bounces:8,postProcess(e){const t=[];e.traverse((e=>{if(e.material)if(e.material instanceof a.MeshPhysicalMaterial){const t=e.material;t.metalness=0,1===t.transmission&&(t.roughness=0,t.metalness=0,e.name.includes("29")?(e.geometry.index.array.reverse(),t.ior=1.52,t.color.set(16777215)):t.ior=1.2)}else e.material.opacity<1&&t.push(e)})),t.forEach((e=>{e.parent.remove(e)}))}},"Scifi Toad":{url:"https://raw.githubusercontent.com/gkjohnson/gltf-demo-models/main/scifi-toad/scene.gltf",credit:'Model by "YuryTheCreator" on Sketchfab.',opacityToTransmission:!0,bounces:8,postProcess(e){e.traverse((e=>{if(e.material&&e.material instanceof a.MeshPhysicalMaterial){const t=e.material;t.metalness=0,t.roughness=.005,t.ior=1.645,t.color.lerp(new a.Color(16777215),.65)}}))}},"Halo Twist Ring":{url:"https://raw.githubusercontent.com/gkjohnson/gltf-demo-models/main/ring-twist-halo/scene.glb",credit:"Model credit NASA / JPL-Caltech",opacityToTransmission:!0,bounces:15,postProcess(e){e.traverse((e=>{if(e.material&&e.material instanceof a.MeshPhysicalMaterial)if(1===e.material.transmission){const t=e.material;t.roughness*=.1,t.metalness=0,t.ior=1.8,t.color.set(16777215)}else e.material.roughness*=.1}))}},"Damaged Helmet":{url:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF/DamagedHelmet.gltf",credit:"glTF Sample Model."},"Flight Helmet":{url:"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/FlightHelmet/glTF/FlightHelmet.gltf",credit:"glTF Sample Model."},Statue:{url:"https://raw.githubusercontent.com/gkjohnson/gltf-demo-models/main/threedscans/Le_Transi_De_Rene_De_Chalon.glb",credit:"Model courtesy of threedscans.com."},"Crab Sculpture":{url:"https://raw.githubusercontent.com/gkjohnson/gltf-demo-models/main/threedscans/Elbow_Crab.glb",rotation:[3.1*Math.PI/4,Math.PI,0],credit:"Model courtesy of threedscans.com."}};let O=Object.keys(B)[0];if(window.location.hash){const e=window.location.hash.substring(1).replaceAll("%20"," ");e in B&&(O=e)}const j={acesToneMapping:!0,resolutionScale:1/window.devicePixelRatio,tilesX:2,tilesY:2,samplesPerFrame:1,model:O,environment:"ENVMAP",envMap:G["Royal Esplanade"],gradientTop:"#bfd8ff",gradientBottom:"#ffffff",environmentIntensity:3,environmentBlur:.35,backgroundType:"Gradient",bgGradientTop:"#111111",bgGradientBottom:"#000000",enable:!0,bounces:3,floorColor:"#080808",floorEnabled:!0,floorRoughness:.1,floorMetalness:0},z=function(e){const t=new Uint8Array(e*e*4);for(let r=0;r<e;r++)for(let n=0;n<e;n++){const a=2*(r/(e-1)-.5),o=2*(n/(e-1)-.5);let i=Math.max(Math.min(1-Math.sqrt(a**2+o**2),1),0);i=i**2,i=Math.min(i,1);const s=n*e+r;t[4*s+0]=255,t[4*s+1]=255,t[4*s+2]=255,t[4*s+3]=255*i}const r=new a.DataTexture(t,e,e);return r.format=a.RGBAFormat,r.type=a.UnsignedByteType,r.minFilter=a.LinearFilter,r.magFilter=a.LinearFilter,r.wrapS=a.RepeatWrapping,r.wrapT=a.RepeatWrapping,r.needsUpdate=!0,r}(2048),W=new a.Mesh(new a.PlaneBufferGeometry,new a.MeshStandardMaterial({map:z,transparent:!0,color:526344,roughness:.1,metalness:0}));W.scale.setScalar(3),W.rotation.x=-Math.PI/2;let U=null;function H(){(new i.RGBELoader).load(j.envMap,(e=>{V.ptRenderer.material.environmentMap&&(V.ptRenderer.material.environmentMap.dispose(),V.scene.environment.dispose());const t=new a.PMREMGenerator(V.renderer).fromEquirectangular(e);e.mapping=a.EquirectangularReflectionMapping,V.ptRenderer.material.environmentIntensity=parseFloat(j.environmentIntensity),V.ptRenderer.material.environmentMap=t.texture,V.scene.environment=e,"Gradient"!==j.backgroundType&&(V.scene.background=e),V.ptRenderer.reset()}))}async function q(){let e;U&&(U.destroy(),U=null);const t=new a.LoadingManager,r=B[j.model];V.pausePathTracing=!0,V.renderer.domElement.style.visibility="hidden",N.innerText="--",P.innerText="--",I.innerText="Loading",I.style.visibility="visible";const n=async()=>{r.removeEmission&&e.traverse((e=>{e.material&&(e.material.emissiveMap=null,e.material.emissiveIntensity=0)})),r.opacityToTransmission&&function(e){e.traverse((e=>{if(e.material){const t=e.material;if(t.opacity<.65&&t.opacity>.2){const r=new a.MeshPhysicalMaterial;for(const e in t)if(e in t){if(null===t[e])continue;t[e].isTexture?r[e]=t[e]:t[e].copy&&t[e].constructor===r[e].constructor?r[e].copy(t[e]):"number"==typeof t[e]&&(r[e]=t[e])}r.opacity=1,r.transmission=1,e.material=r}}}))}(e),e.traverse((e=>{e.material&&(e.material.side=a.DoubleSide)})),r.postProcess&&r.postProcess(e);const t=new a.Box3;t.setFromObject(e),e.position.addScaledVector(t.min,-.5).addScaledVector(t.max,-.5);const n=new a.Sphere;t.getBoundingSphere(n),e.scale.setScalar(1/n.radius),e.position.multiplyScalar(1/n.radius),t.setFromObject(e),r.rotation&&e.rotation.set(...r.rotation);const o=new a.Group;W.position.y=t.min.y,o.add(e,W),await V.setModel(o,{onProgress:e=>{const t=Math.floor(100*e);I.innerText=`Building BVH : ${t}%`}}),I.style.visibility="hidden",P.innerHTML=r.credit||"",P.style.visibility=r.credit?"visible":"hidden",j.bounces=r.bounces||3,V.ptRenderer.material.setDefine("BOUNCES",j.bounces),function(){U&&U.destroy(),U=new C.GUI,U.add(j,"model",Object.keys(B)).onChange(q);const e=U.addFolder("resolution");e.add(j,"resolutionScale",.1,1,.01).onChange((e=>{V.setScale(parseFloat(e))})),e.add(j,"samplesPerFrame",1,10,1).onChange((e=>{V.samplesPerFrame=parseInt(e)})),e.add(j,"tilesX",1,10,1).onChange((e=>{V.ptRenderer.tiles.x=parseInt(e)})),e.add(j,"tilesY",1,10,1).onChange((e=>{V.ptRenderer.tiles.y=parseInt(e)})),e.open();const t=U.addFolder("environment");t.add(j,"envMap",G).name("map").onChange(H),t.add(j,"environmentBlur",0,1,.01).onChange((e=>{V.ptRenderer.material.environmentBlur=parseFloat(e),V.ptRenderer.reset()})).name("env map blur"),t.add(j,"environmentIntensity",0,10,.01).onChange((e=>{V.ptRenderer.material.environmentIntensity=parseFloat(e),V.ptRenderer.reset()})).name("intensity"),t.open();const r=U.addFolder("background");r.add(j,"backgroundType",["Environment","Gradient"]).onChange((e=>{V.ptRenderer.material.setDefine("GRADIENT_BG",Number("Gradient"===e)),V.scene.background="Gradient"===e?new a.Color(394758):V.scene.environment,V.ptRenderer.reset()})),r.addColor(j,"bgGradientTop").onChange((e=>{V.ptRenderer.material.uniforms.bgGradientTop.value.set(e),V.ptRenderer.reset()})),r.addColor(j,"bgGradientBottom").onChange((e=>{V.ptRenderer.material.uniforms.bgGradientBottom.value.set(e),V.ptRenderer.reset()})),r.open();const n=U.addFolder("floor");n.add(j,"floorEnabled").onChange((e=>{W.material.opacity=e?1:0,V.ptRenderer.reset()})),n.addColor(j,"floorColor").onChange((e=>{W.material.color.set(e),V.ptRenderer.reset()})),n.add(j,"floorRoughness",0,1).onChange((e=>{W.material.roughness=e,V.ptRenderer.reset()})),n.add(j,"floorMetalness",0,1).onChange((e=>{W.material.metalness=e,V.ptRenderer.reset()}));const o=U.addFolder("path tracing");o.add(j,"enable").onChange((e=>{V.enablePathTracing=e})),o.add(j,"acesToneMapping").onChange((e=>{V.renderer.toneMapping=e?a.ACESFilmicToneMapping:a.NoToneMapping,V.fsQuad.material.needsUpdate=!0})),o.add(j,"bounces",1,20,1).onChange((e=>{V.ptRenderer.material.setDefine("BOUNCES",parseInt(e)),V.ptRenderer.reset()})),o.open()}(),V.pausePathTracing=!1,V.renderer.domElement.style.visibility="visible"},i=r.url;if(/(gltf|glb)$/i.test(i))t.onLoad=n,new s.GLTFLoader(t).setMeshoptDecoder(o.MeshoptDecoder).load(i,(t=>{e=t.scene}),(e=>{if(0!==e.total&&e.total>=e.loaded){const t=Math.floor(100*e.loaded/e.total);I.innerText=`Loading : ${t}%`}}));else if(/mpd$/i.test(i)){t.onProgress=(e,t,r)=>{const n=Math.floor(100*t/r);I.innerText=`Loading : ${n}%`};const r=new M(t);await r.preloadMaterials("https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/colors/ldcfgalt.ldr"),r.setPartsLibraryPath("https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/complete/ldraw/").load(i,(t=>{e=class{static mergeObject(e){function t(e,t,r,n){const o=new a.BufferGeometry,i=e.getAttribute("position").array,s=3===r?e.getAttribute("normal").array:null,l=Math.min(t.count,Math.floor(i.length/3)-t.start),c=3*t.start,d=3*(t.start+l),u=i.subarray(c,d),h=null!==s?s.subarray(c,d):null;if(o.setAttribute("position",new a.BufferAttribute(u,3)),null!==h&&o.setAttribute("normal",new a.BufferAttribute(h,3)),n){const t=e.getAttribute("control0").array.subarray(c,d),r=e.getAttribute("control1").array.subarray(c,d),n=e.getAttribute("direction").array.subarray(c,d);o.setAttribute("control0",new a.BufferAttribute(t,3,!1)),o.setAttribute("control1",new a.BufferAttribute(r,3,!1)),o.setAttribute("direction",new a.BufferAttribute(n,3,!1))}return o}function r(e,t,r){const n=r[e.uuid];n?n.arr.push(t):r[e.uuid]={mat:e,arr:[t]}}function n(e,t){if(!e)return;const r=e.array,n=Math.floor(r.length/3);let a=0;for(let e=0;e<n;e++){const e=r[a],n=r[a+1],o=r[a+2];r[a]=r[a+3],r[a+1]=r[a+4],r[a+2]=r[a+5],r[a+3]=e,r[a+4]=n,r[a+5]=o,a+=3*t}}const o={},i={},s={};e.updateMatrixWorld(!0);const l=new a.Matrix3;e.traverse((e=>{if(e.isMesh|e.isLineSegments){const a=e.isMesh?3:2,c=e.geometry.clone();e.matrixWorld.determinant()<0&&(n(c.attributes.position,a),n(c.attributes.normal,a)),c.applyMatrix4(e.matrixWorld),e.isConditionalLine&&(c.attributes.control0.applyMatrix4(e.matrixWorld),c.attributes.control1.applyMatrix4(e.matrixWorld),l.getNormalMatrix(e.matrixWorld),c.attributes.direction.applyNormalMatrix(l));const d=e.isMesh?o:e.isConditionalLine?s:i;if(Array.isArray(e.material))for(const n in c.groups){const o=c.groups[n];r(e.material[o.materialIndex],t(c,o,a,e.isConditionalLine),d)}else r(e.material,c,d)}}));const c=new a.Group,d=Object.keys(o);for(const e of d){const t=o[e],r=v.mergeBufferGeometries(t.arr);c.add(new a.Mesh(r,t.mat))}const u=Object.keys(i);for(const e of u){const t=i[e],r=v.mergeBufferGeometries(t.arr);c.add(new a.LineSegments(r,t.mat))}const h=Object.keys(s);for(const e of h){const t=s[e],r=v.mergeBufferGeometries(t.arr),n=new a.LineSegments(r,t.mat);n.isConditionalLine=!0,c.add(n)}return c.userData.constructionStep=0,c.userData.numConstructionSteps=1,c}}.mergeObject(t),e.rotation.set(Math.PI,0,0),e.traverse((e=>{e.isLineSegments&&(e.visible=!1),e.isMesh&&(e.material.roughness*=.01)})),n()}))}}const $=new D;document.body.appendChild($.dom),V.renderer.physicallyCorrectLights=!0,V.renderer.toneMapping=a.ACESFilmicToneMapping,V.ptRenderer.material.setDefine("GRADIENT_BG",1),V.scene.background=new a.Color(394758),V.ptRenderer.tiles.set(j.tilesX,j.tilesY),V.setScale(j.resolutionScale),V.onRender=()=>{$.update();const e=Math.floor(V.ptRenderer.samples);N.innerText=`samples: ${e}`},q(),H();
//# sourceMappingURL=index.7e44f4ab.js.map
